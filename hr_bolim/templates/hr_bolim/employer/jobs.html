{% extends 'hr_bolim/base_with_sidebar.html' %}
{% load static %}

{% block title %}Vakansiyalar{% endblock %}

{% block employer_content %}
<div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
        <!-- Filters -->
        <div class="bg-white rounded-lg shadow p-6 mb-6">
            <div class="grid grid-cols-1 md:grid-cols-4 gap-4">
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Status</label>
                    <select class="form-input" id="statusFilter">
                        <option value="">Barchasi</option>
                        <option value="active">Faol</option>
                        <option value="draft">Draft</option>
                        <option value="closed">Yopilgan</option>
                        <option value="paused">Pauza</option>
                    </select>
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Ish turi</label>
                    <select class="form-input" id="typeFilter">
                        <option value="">Barchasi</option>
                        <option value="full-time">To'liq stavka</option>
                        <option value="part-time">Qisman stavka</option>
                        <option value="remote">Masofaviy</option>
                        <option value="hybrid">Gibrid</option>
                        <option value="internship">Stajirovka</option>
                    </select>
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Qidirish</label>
                    <input type="text" id="searchInput" placeholder="Lavozim nomi..." class="form-input">
                </div>
                <div class="flex items-end">
                    <button onclick="filterJobs()" class="w-full px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700">
                        Filtrlash
                    </button>
                </div>
            </div>
        </div>

        <!-- Jobs List -->
        <div class="bg-white rounded-lg shadow">
            <div class="px-6 py-4 border-b border-gray-200">
                <div class="flex justify-between items-center">
                    <h2 class="text-lg font-semibold text-gray-900">Barcha vakansiyalar ({{ jobs.count }})</h2>
                    <div class="flex space-x-2">
                        <button onclick="exportJobs()" class="px-3 py-1 text-sm bg-gray-100 text-gray-700 rounded hover:bg-gray-200">
                            üìä Export
                        </button>
                    </div>
                </div>
            </div>
            
            <div class="divide-y divide-gray-200">
                {% for job in jobs %}
                <div class="p-6 hover:bg-gray-50 job-item" data-status="{{ job.status }}" data-type="{{ job.employment_type }}" data-title="{{ job.title|lower }}">
                    <div class="flex justify-between items-start">
                        <div class="flex-1">
                            <div class="flex items-center space-x-3">
                                <h3 class="text-lg font-medium text-gray-900">{{ job.title }}</h3>
                                <span class="inline-flex px-2 py-1 text-xs font-semibold rounded-full 
                                    {% if job.status == 'active' %}bg-green-100 text-green-800
                                    {% elif job.status == 'draft' %}bg-gray-100 text-gray-800
                                    {% elif job.status == 'closed' %}bg-red-100 text-red-800
                                    {% else %}bg-yellow-100 text-yellow-800{% endif %}">
                                    {{ job.get_status_display }}
                                </span>
                                <span class="inline-flex px-2 py-1 text-xs font-semibold rounded-full bg-blue-100 text-blue-800">
                                    {{ job.get_employment_type_display }}
                                </span>
                            </div>
                            
                            <div class="mt-2 grid grid-cols-2 md:grid-cols-4 gap-4 text-sm text-gray-600">
                                <div>
                                    <span class="font-medium">Maosh:</span>
                                    {% if job.salary_min and job.salary_max %}
                                        {{ job.salary_min }} - {{ job.salary_max }} so'm
                                    {% elif job.salary_min %}
                                        {{ job.salary_min }} so'm dan
                                    {% else %}
                                        Kelishilgan
                                    {% endif %}
                                </div>
                                <div>
                                    <span class="font-medium">Joylashuv:</span> {{ job.location }}
                                </div>
                                <div>
                                    <span class="font-medium">Joylar:</span> {{ job.positions_count }}
                                </div>
                                <div>
                                    <span class="font-medium">Deadline:</span> {{ job.deadline|date:"d.m.Y" }}
                                </div>
                            </div>
                            
                            <div class="mt-3 flex items-center space-x-6 text-sm text-gray-600">
                                <span>üëÅ {{ job.view_count }} ko'rilgan</span>
                                <span>üìÑ {{ job.application_count }} ariza</span>
                                <span>üìÖ {{ job.created_at|date:"d.m.Y" }}</span>
                            </div>
                        </div>
                        
                        <div class="ml-4 flex space-x-2">
                            <a href="{% url 'edit_job' job.id %}" class="p-2 text-blue-600 hover:bg-blue-50 rounded-lg" title="Tahrirlash">
                                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"></path>
                                </svg>
                            </a>
                            {% if job.status == 'active' %}
                                <button onclick="toggleJobStatus({{ job.id }}, 'paused')" class="p-2 text-yellow-600 hover:bg-yellow-50 rounded-lg" title="Pauza">
                                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 9v6m4-6v6m7-3a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                                    </svg>
                                </button>
                            {% elif job.status == 'paused' %}
                                <button onclick="toggleJobStatus({{ job.id }}, 'active')" class="p-2 text-green-600 hover:bg-green-50 rounded-lg" title="Faollashtirish">
                                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M14.752 11.168l-3.197-2.132A1 1 0 0010 9.87v4.263a1 1 0 001.555.832l3.197-2.132a1 1 0 000-1.664z"></path>
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                                    </svg>
                                </button>
                            {% endif %}
                            <button onclick="deleteJob({{ job.id }})" class="p-2 text-red-600 hover:bg-red-50 rounded-lg" title="O'chirish">
                                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"></path>
                                </svg>
                            </button>
                        </div>
                    </div>
                </div>
                {% empty %}
                <div class="p-12 text-center">
                    <svg class="w-16 h-16 text-gray-400 mx-auto mb-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 13.255A9.001 9.001 0 0112 21a9.001 9.001 0 01-9-9.255V12A9 9 0 0112 3a9 9 0 019 9v.255z"></path>
                    </svg>
                    <h3 class="text-lg font-medium text-gray-900 mb-2">Vakansiyalar yo'q</h3>
                    <p class="text-gray-600 mb-4">Hali hech qanday vakansiya joylamagansiz</p>
                    <a href="{% url 'create_job' %}" class="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700">
                        Birinchi vakansiyani yarating
                    </a>
                </div>
                {% endfor %}
            </div>
        </div>
    </div>
</div>

<style>
.form-input {
    width: 100%;
    padding: 8px 12px;
    border: 1px solid #d1d5db;
    border-radius: 6px;
    font-size: 14px;
}

.form-input:focus {
    outline: none;
    border-color: #3b82f6;
    box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
}
</style>

<script>
function filterJobs() {
    const status = document.getElementById('statusFilter').value;
    const type = document.getElementById('typeFilter').value;
    const search = document.getElementById('searchInput').value.toLowerCase();
    
    const jobs = document.querySelectorAll('.job-item');
    
    jobs.forEach(job => {
        const jobStatus = job.dataset.status;
        const jobType = job.dataset.type;
        const jobTitle = job.dataset.title;
        
        const statusMatch = !status || jobStatus === status;
        const typeMatch = !type || jobType === type;
        const searchMatch = !search || jobTitle.includes(search);
        
        if (statusMatch && typeMatch && searchMatch) {
            job.style.display = 'block';
        } else {
            job.style.display = 'none';
        }
    });
}

function toggleJobStatus(jobId, newStatus) {
    if (confirm('Vakansiya holatini o\'zgartirishni istaysizmi?')) {
        // You can implement this with AJAX
        window.location.href = `/employer/jobs/${jobId}/toggle-status/${newStatus}/`;
    }
}

function deleteJob(jobId) {
    if (confirm('Vakansiyani o\'chirishni istaysizmi? Bu amal ortga qaytarilmaydi.')) {
        window.location.href = `{% url 'delete_job' 0 %}`.replace('0', jobId);
    }
}

function exportJobs() {
    // Export functionality
    alert('Export funksiyasi tez orada qo\'shiladi');
}

// Real-time search
document.getElementById('searchInput').addEventListener('input', filterJobs);
</script>
{% endblock %}
